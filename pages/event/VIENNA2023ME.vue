<template>
  <div>
    <BaseSection>
      <img class="w-full" src="/VIENNA2023ME/banner.jpg">
      <BaseTitle class="text-center" size="2">
        REGISTRATION FORUM  2023<br />
        22/05/2023 - 24/05/2023 | VIENNA
      </BaseTitle>
      <p class="text-center font-bold">
        It is with great pleasure that we hereby invite you to the next Forum on May 22th till 24th , 2023 which will take place in Vienna (Austria).
      </p>
    </BaseSection>
    <BaseSection>
      <p>
        This year the theme of the Euro-Mat Forum is ‘Unlocking Innovation’.
      </p>
      <p>
        The market is changing constantly and the need of new solutions and technologies against many challenges is
        bigger than ever. The construction industry is no exception here.
      </p>
      <p>
        One part of the program is our Innovation Day. Suppliers will have their own stands where they can show our
        beautiful network what makes their companies unique. This formula replaces the one-to-one meetings and gives the opportunity to have more interaction between suppliers and shareholders in an inspirational environment.
      </p>
      <p>
        We talk about Innovation in a broad spectrum: customer experience innovation, product innovation, system
        innovation...So be creative, your stand is waiting for you...and so are we!
      </p>
      <p>
        More information about the Forum Innovation Day will follow in an online session planned on March, 21st from
        10:30 till 11:00 AM (CET). An invitation will be sent shortly to you for this online session.
      </p>
      <p>
        See you in Vienna!
      </p>
    </BaseSection>
    <BaseSection title="Program">
      <TableBase>
        <TableRow>
          <TableHead colspan="2">
            MONDAY 22nd MAY 2023
          </TableHead>
        </TableRow>
        <TableRow>
          <TableHead class="w-1/4">
            12:00
          </TableHead>
          <TableData>
            Arrival of the Euro-Mat shareholders at the Andaz hotel & Check-in Luggage drop-off
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            13:00
          </TableHead>
          <TableData>
            Transfer to Wienerberger AG (*for Euro-Mat shareholders only)
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            13:30
          </TableHead>
          <TableData>
            Lunch at  Wienerberger AG (*for Euro-Mat shareholders only)
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            14:00
          </TableHead>
          <TableData>
            Visit Wienerberger & presentation (*for Euro-Mat shareholders only)
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            15:30
          </TableHead>
          <TableData>
            General meeting (*for Euro-Mat shareholders only)
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            17:30
          </TableHead>
          <TableData>
            Transfer back to the Andaz hotel (*for Euro-Mat shareholders only)
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            19:00
          </TableHead>
          <TableData>
            Network drinks with Euro-Mat shareholders & Euro-Mat suppliers at the Foyer of the hotel
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            20:00-23:00
          </TableHead>
          <TableData>
            Dinner with Euro-Mat shareholders & Euro-Mat suppliers at the Upper Belvedere of the hotel
          </TableData>
        </TableRow>
      </TableBase>
      <TableBase>
        <TableRow>
          <TableHead colspan="2">
            TUESDAY 23rd MAY 2023
          </TableHead>
        </TableRow>
        <TableRow>
          <TableHead class="w-1/4">
            09:00-12:30
          </TableHead>
          <TableData>
            Innovation Day Part I at the Conference Room at the Andaz hotel<br />
            Keynote ‘When the wind of change blows, true innovators build windmills instead of walls’
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            12:30-13:30
          </TableHead>
          <TableData>
            Lunch at the Andaz hotel
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            14:00-17:00
          </TableHead>
          <TableData>
            Innovation Day Part II at the Conference Room at the Andaz hotel.
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            18:30
          </TableHead>
          <TableData>
            Transfer to Restaurant Pfarwirrt & Guided tour by bus
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            19:30
          </TableHead>
          <TableData>
            Drinks at Restaurant Pfarwirrt & Award Ceremony
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            20:00
          </TableHead>
          <TableData>
            Dinner at Restaurant Pfarwirrt
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            23:00
          </TableHead>
          <TableData>
            Transfer back to the Andaz hotel
          </TableData>
        </TableRow>
      </TableBase>
      <TableBase>
        <TableRow>
          <TableHead colspan="2">
            WEDNESDAY 24th MAY 2023
          </TableHead>
        </TableRow>
        <TableRow>
          <TableHead class="w-1/4">
            08:30
          </TableHead>
          <TableData>
            Transfer to University Vienna
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            09:00
          </TableHead>
          <TableData>
            Presentation of TU Vienna followed by 3 sessions of different professors involved in our Master Class ‘The Future of Building’
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            12:00
          </TableHead>
          <TableData>
            Lunch at TU Vienna
          </TableData>
        </TableRow>
        <TableRow>
          <TableHead>
            13:00
          </TableHead>
          <TableData>
            Transfer back to hotel Andaz & pick up luggage
          </TableData>
        </TableRow>
      </TableBase>
    </BaseSection>
    <BaseSection title="Participations costs">
      <BaseTitle size="3">Price for the full event:</BaseTitle>
      <p>
        €995- p.p  Early Bird Price  - Ends on March 20th , 2023
      </p>
      <p>
        €1360- p.p.  from March 20th till April 15th, 2023
      </p>
      <p>
        For organizational reasons, please sign in at the latest on April 15th, 2023.
      </p>
      <p>
        <b>NEW:</b><br />
        Euro-Mat works with a new partner named X-perience regarding the organisation of events.
      </p>
      <p>
        Please note that you will receive an invoice after your registration from our partner X-perience.
      </p>
      <p>
        Your registration will be definitive after payment. No refund will be made for non-attendance.
      </p>
      Package deal includes (p.p):
      <ul class="pl-4">
        <li>&check;	Accomodation: single room for 2 nights at hotel Andaz Vienna Am Belvedere (May 22<sup>nd</sup> + May 23<sup>rd</sup>)</li>
        <li>&check; 3 Lunches (May 22<sup>nd</sup>, 23<sup>rd</sup> & 24<sup>th</sup>)</li>
        <li>&check; 2 Dinners (May 22<sup>nd</sup>, 23<sup>rd</sup>)</li>
        <li>&check; Visit Wienerberger (for Euro-Mat shareholders only)</li>
        <li>&check; Conference Costs Innovation Day</li>
        <li>&check; 3 Sessions TU Vienna to introduce the Master Class ‘The Future of Building’.</li>
        <li>&check; Keynote ‘When the wind of change blows, true innovators build windmills instead of walls’.</li>
        <li>&check; Guided tour of Vienna per bus</li>
        <li>&check; Transfers (to Wienerberger, restaurant and TU Vienna and back to the hotel</li>
        <li>&check; Other conference costs</li>
      </ul>
    </BaseSection>
    <BaseSection title="Registration Form">
      <TimeLine :pos="timeLinePos" :steps="timeLineSteps" />
      <br />
      <RegistrationGeneralInfo v-model="generalInfo" v-show="timeLinePos === 1" @submit="timeLinePos += 1" />
      <RegistrationParticipantsInfo v-model="participantsInfo" v-show="timeLinePos === 2" @submit="timeLinePos += 1" />
      <div v-if="timeLinePos === 3">
        <BaseTitle v-if="generalInfo.participate" size="2">Confirm Form info</BaseTitle>
        <BaseTitle v-else size="2">Declination info</BaseTitle>
        <hr />
        <BaseTitle size="3">General Info</BaseTitle>
        <p>
          Participation: {{ generalInfo.participate ? 'Yes' : 'No' }}<br />
          E-mail address: {{ generalInfo.email }}<br />
          Company name: {{ generalInfo.companyName }}<br />
          Note: {{ participantsInfo.note }}
        </p>
        <hr />
        <BaseTitle size="3">Participants Info</BaseTitle>
        <p v-for="(participant, index) in participantsInfo.participants" :key="index">
          <BaseTitle size="4">Participant {{ index + 1 }}</BaseTitle>
          E-mail: {{ participant.email }}<br />
          Name: {{ participant.firstName }} {{ participant.lastName }}<br />
          Phone number: {{ participant.phoneNumber }}
        </p>
        <br />
        <template v-if="generalInfo.participate">
          <p class="my-2">
            Euro-Mat works with a new partner named X-perience regarding the organisation of events.
          </p>
          <p class="my-2">
            Please note that you will receive an invoice after your registration from our partner X-perience.
          </p>
          <p class="my-2">
            Your registration will be definitive after payment. No refund will be made for non-attendance.
          </p>
          <p>
            X-perience<br />
            Latemstraat 16<br />
            9830 Sint-Martens-Latem<br />
            <br />
            <LinkNormal href="https://www.travel-lounge.be/">www.travel-lounge.be</LinkNormal>
          </p>
          <p class="text-center my-6">
            We look forward to welcoming you at the Forum 2023 in Vienna!
          </p>
        </template>
        <template v-else>
          <p class="my-2">
            Your declination for the Euro-Mat Forum 2023 in Vienna has been well noted.
          </p>
          <p class="text-center my-6">
            We hope to see you soon at a next event.
          </p>
        </template>
        <FormSubmitButton @click="submit">Submit</FormSubmitButton>
        <p class="my-4 p-4 border-2 border-red-600 bg-red-400 text-white text-lg" v-show="error">
          {{ error }}
        </p>
      </div>
      <LoadingScreen v-show="loading" />
      <ButtonBase icon="mdi:arrow-left-thin" v-show="timeLinePos > 1" @click="timeLinePos -= 1; error = ''">Go back</ButtonBase>
    </BaseSection>
  </div>
</template>
<script setup lang="ts">
import {ParticipantsInfo} from "~/schema/ParticipantsInfo";
import {GeneralInfo} from "~/schema/GeneralInfo";
import BaseSection from "~/components/BaseSection.vue";

const eventCode = useState('eventCode', () => "VIENNA2023ME")
const loading = useState('loading', () => false)

const timeLinePos = useState('timeLinePos', () => 1);
const timeLineSteps = useState('timeLineMax', () => ['General info', 'Participants info', 'Confirmation']);

const generalInfo = useState('generalInfo', () => {return {} as GeneralInfo});
const participantsInfo = useState('participantsInfo', () => {return {participants: [], note: ""} as ParticipantsInfo});

const router = useRouter()
const route = useRoute()
const runtimeConfig = useRuntimeConfig()
const error = useState('error', () => "")

async function submit() {
  // if (route.query['invitation_code']?.length !== 16) {
  //   error.value = "Invitation code is not valid."
  //   return;
  // }

  const persons = [] as object[];

  participantsInfo.value.participants.forEach(participant => {
    persons.push({
      email: participant.email,
      first_name: participant.firstName,
      last_name: participant.lastName,
      phone: participant.phoneNumber
    })
  })

  try {
    loading.value = true;
    const result = await fetch(`${runtimeConfig.public.apiUrl}/event/${eventCode.value}/register`, {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        //invitation_code: route.query['invitation_code'],
        participate: generalInfo.value.participate,
        company_name: generalInfo.value.companyName,
        email: generalInfo.value.email,
        note: participantsInfo.value.note,
        persons: persons
      })
    })
    loading.value = false;

    if (result.ok) {
      router.push({name: 'success'})
    } else {
      console.error(await result.text())
      switch(result.status) {
        case 400:
          error.value = "Some values have not been correctly filled in."
          break;
        case 401:
          error.value = "Event is closed for registrations."
          break;
        case 403:
          error.value = "Invitation code is not valid."
          break;
        case 404:
          error.value = "Event does not exist."
          break;
        case 409:
          error.value = "Registration is already completed."
          break;
        default:
          error.value = "Unknown error has occurred.";
          break;
      }
    }
  } catch (e) {
    console.error(e)
    error.value = "Network error has occurred.";
    loading.value = false;
  }


  // const { data, pending, error } = await useFetch(`${runtimeConfig.public.apiUrl}/event/${eventCode}/register`, {
  //   method: "post",
  //   headers: {
  //     'Content-Type': 'application/json',
  //   },
  //   body: JSON.stringify({
  //     participate: generalInfo.value.participate,
  //     companyName: generalInfo.value.companyName,
  //     email: generalInfo.value.email,
  //     note: generalInfo.value.note,
  //     persons: persons
  //   })
  // })
}
</script>